jQuery(document).ready(function(t){var o=t(".wcfmmp-product-geolocate-search-form");if(t(".wcfmmp-product-geolocate-search-form").length>0&&t("#wcfmmp_radius_addr").length>0){var e=parseInt(wcfmmp_product_list_options.max_radius),a=document.getElementById("wcfmmp_radius_addr");if("google"==wcfm_maps.lib){var r=new google.maps.Geocoder,i=new google.maps.places.Autocomplete(a);i.addListener("place_changed",function(){var o=i.getPlace();t("#wcfmmp_radius_lat").val(o.geometry.location.lat()),t("#wcfmmp_radius_lng").val(o.geometry.location.lng())})}else var n=new L.Control.Search({container:"wcfm_radius_filter_container",url:"https://nominatim.openstreetmap.org/search?format=json&q={s}",jsonpParam:"json_callback",propertyName:"display_name",propertyLoc:["lat","lon"],marker:L.marker([0,0]),moveToLocation:function(o,e,a){t("#wcfmmp_radius_lat").val(o.lat),t("#wcfmmp_radius_lng").val(o.lng)},initial:!1,collapsed:!1,autoType:!1,minLength:2});if(t("#wcfmmp_radius_range").on("input",function(){t(".wcfmmp_radius_range_cur").html(this.value+wcfmmp_product_list_options.radius_unit),wcfmmp_product_list_options.is_rtl?t(".wcfmmp_radius_range_cur").css("right",this.value/e*t(".wcfm_radius_slidecontainer").outerWidth()-7.5+"px"):t(".wcfmmp_radius_range_cur").css("left",this.value/e*t(".wcfm_radius_slidecontainer").outerWidth()-7.5+"px"),$wcfmmp_radius_lat=t("#wcfmmp_radius_lat").val(),$wcfmmp_radius_lat}),wcfmmp_product_list_options.is_rtl?t(".wcfmmp_radius_range_cur").css("right",t("#wcfmmp_radius_range").val()/e*t(".wcfm_radius_slidecontainer").outerWidth()-7.5+"px"):t(".wcfmmp_radius_range_cur").css("left",t("#wcfmmp_radius_range").val()/e*t(".wcfm_radius_slidecontainer").outerWidth()-7.5+"px"),navigator.geolocation){t(".wcfmmmp_locate_icon").on("click",function(){navigator.geolocation.getCurrentPosition(function(e){console.log(e.coords.latitude,e.coords.longitude),"google"==wcfm_maps.lib?r.geocode({location:{lat:e.coords.latitude,lng:e.coords.longitude}},function(a,r){"OK"===r&&(t("#wcfmmp_radius_addr").val(a[0].formatted_address),t("#wcfmmp_radius_lat").val(e.coords.latitude),t("#wcfmmp_radius_lng").val(e.coords.longitude),o.submit())}):t.get("https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat="+e.coords.latitude+"&lon="+e.coords.longitude,function(a){t("#wcfm_radius_filter_container").find(".search-input").val(a.address.road),t("#wcfmmp_radius_lat").val(e.coords.latitude),t("#wcfmmp_radius_lng").val(e.coords.longitude),o.submit()})})}),wcfmmp_product_list_options.is_geolocate&&(t("#wcfmmp_radius_lat").val()||t(".wcfmmmp_locate_icon").click())}}if(t(".wcfmmp-product-list-map").length>0){t(".wcfmmp-product-list-map").css("height",t(".wcfmmp-product-list-map").outerWidth()/2);var s=[],c=markerClusterer="";if(wcfmmp_product_list_options.is_poi)m=[];else var m=[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}];if("google"==wcfm_maps.lib){var l={zoom:$map_zoom,center:new google.maps.LatLng(wcfmmp_product_list_options.default_lat,wcfmmp_product_list_options.default_lng,13),mapTypeId:wcfm_maps.map_type,styles:m};c=new google.maps.Map(document.getElementById("wcfmmp-product-list-map"),l)}else c=L.map("wcfmmp-product-list-map",{center:[wcfmmp_product_list_options.default_lat,wcfmmp_product_list_options.default_lng],minZoom:2,zoom:13,zoomAnimation:!1}),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{subdomains:["a","b","c"]}).addTo(c),n&&t("#wcfmmp_radius_addr").length>0&&(c.addControl(n),t("#wcfm_radius_filter_container").find(".search-input").addClass("wcfmmp-radius-addr").attr("id","wcfmmp_radius_addr").attr("name","radius_addr").css("float","none").attr("placeholder",wcfmmp_product_list_options.search_location).val(t("#wcfmmp_radius_addr").val()),t("#wcfmmp_radius_addr").remove());!function(){if(t(".wcfmmp-product-list-map").length>0){!function(){if("google"==wcfm_maps.lib)for(var t=0;t<s.length;t++)s[t].setMap(null);s=[]}();var o={search_term:"",wcfmmp_store_category:"",wcfmmp_store_country:"",wcfmmp_store_state:"",action:"wcfmmp_stores_list_map_markers",pagination_base:1,paged:1,per_row:$per_row,per_page:$per_page,includes:$includes,excludes:$excludes,has_product:$has_product,has_orderby:$has_orderby,sidebar:$sidebar,theme:$theme,search_data:""};t.post(wcfm_params.ajax_url,o,function(o){if(o.success){var e=o.data;!function(o){if($icon_width=parseInt(wcfmmp_product_list_options.icon_width),$icon_height=parseInt(wcfmmp_product_list_options.icon_height),"google"==wcfm_maps.lib){var e=new google.maps.LatLngBounds,a=new google.maps.InfoWindow;if(t.each(o,function(t,o){var r=new google.maps.LatLng(o.lat,o.lang);e.extend(r);var i={url:o.icon,scaledSize:new google.maps.Size($icon_width,$icon_height)},n=new google.maps.Marker({position:r,map:c,animation:google.maps.Animation.DROP,title:o.name,icon:i,zIndex:t}),m=o.info_window_content;google.maps.event.addListener(n,"click",function(t,o){return function(){a.setContent(m),a.open(c,t)}}(n)),c.setCenter(n.getPosition()),s.push(n)}),wcfmmp_product_list_options.is_cluster){const t=wcfmmp_product_list_options.cluster_image;markerClusterer&&markerClusterer.clearMarkers(),markerClusterer=new MarkerClusterer(c,s,{imagePath:t})}$auto_zoom&&o.length>0&&c.fitBounds(e)}else t.each(o,function(t,e){var a=L.icon({iconUrl:e.icon,iconSize:[$icon_width,$icon_height]}),r=L.marker([e.lat,e.lang],{icon:a}).bindPopup(e.info_window_content);s.push(r);var i=L.featureGroup(s).addTo(c);$auto_zoom&&o.length>0&&setTimeout(function(){c.fitBounds(i.getBounds())},1e3)})}(t.parseJSON(e))}})}}()}});